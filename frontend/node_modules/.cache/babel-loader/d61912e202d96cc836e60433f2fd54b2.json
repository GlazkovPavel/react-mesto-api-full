{"ast":null,"code":"import _toConsumableArray from\"/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import AddPlacePopup from\"./AddPlacePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import EditProfilePopup from\"./EditProfilePopup\";import api from\"../utils/api\";import ImagePopup from\"./ImagePopup\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import{Route,Switch,useHistory}from'react-router-dom';import{Login}from\"./Login\";import{Register}from\"./Register\";import{ProtectedRoute}from\"./ProtectedRoute\";import{InfoTooltip}from\"./InfoTooltip\";import*as apiAuth from\"../utils/apiAuth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setEditAvatarPopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),cards=_React$useState8[0],setCards=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),selectedCard=_React$useState10[0],setSelectedCard=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isImagePopupOpen=_React$useState12[0],setImagePopupOpen=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isLoading=_React$useState16[0],setIsLoading=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isLoggedIn=_React$useState18[0],setIsLoggedIn=_React$useState18[1];var _React$useState19=React.useState(''),_React$useState20=_slicedToArray(_React$useState19,2),email=_React$useState20[0],setEmail=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),isInfoTooltipOpen=_React$useState22[0],setInfoTooltipOpen=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),tooltipStatus=_React$useState24[0],setToolTipStatus=_React$useState24[1];var history=useHistory();React.useEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){apiAuth.getContent(jwt).then(function(res){setEmail(res.email);setIsLoggedIn(true);history.push('/');setCurrentUser(res);}).catch(function(err){return console.error(err);});api.getInitialCards().then(function(res){setCards(res.data.reverse());}).catch(function(err){console.error(err);});}},[history,isLoggedIn]);React.useEffect(function(){api.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){console.error(err);});},[]);React.useEffect(function(){api.getInitialCards().then(function(res){setCards(res.data.reverse());}).catch(function(err){console.error(err);});},[]);function register(email,password){apiAuth.register(email,password).then(function(res){if(res){setToolTipStatus(false);setInfoTooltipOpen(true);history.push('/signin');}}).catch(function(err){setToolTipStatus(true);setInfoTooltipOpen(true);console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function enter(email,password){apiAuth.enter(email,password).then(function(data){if(data.token){setToolTipStatus(false);setInfoTooltipOpen(false);localStorage.setItem('jwt',data.token);setIsLoggedIn(true);history.push('/');setEmail(email);}else{setToolTipStatus(true);setInfoTooltipOpen(true);}}).catch(function(err){setToolTipStatus(true);setInfoTooltipOpen(true);console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function signOut(){localStorage.removeItem('jwt');setIsLoggedIn(false);history.push('/signin');}var changeLoading=function changeLoading(){setIsLoading(true);};var handleCardClick=function handleCardClick(data){setImagePopupOpen(true);setSelectedCard(data);};var closeAllPopups=function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setImagePopupOpen(false);setInfoTooltipOpen(false);};var handleEditProfileClick=function handleEditProfileClick(){setEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setAddPlacePopupOpen(true);};function handleEditAvatarClick(){setEditAvatarPopupOpen(true);}//Меняет информацию о пользователе\nvar handleUpdateUser=function handleUpdateUser(data){api.setUserInfo(data).then(function(res){setCurrentUser(res.data);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};//Меняет аватар\nvar handleUpdateAvatar=function handleUpdateAvatar(data){api.changeAvatar(data).then(function(res){setCurrentUser(res.data);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};//Добавление новой карточки\nvar handleAddPlaceSubmit=function handleAddPlaceSubmit(newCard){api.setCardServer(newCard).then(function(res){setCards([res.data].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard.data:c;});// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n//проверяет если id предыдущей карточки равен id полученной при PUT-запросе, то создавай новую карточку из запроса иначе оставляй старую\nsetCards(newCards);}).catch(function(err){console.error(err);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(){setCards(cards.filter(function(c){return c._id!==card._id;}));}).catch(function(err){console.error(err);});}React.useEffect(function(){window.addEventListener('keydown',function(e){if(e.key==='Escape'){closeAllPopups();}});},[]);function overlayClick(e){if(e.classList.contains('popup')){closeAllPopups();}}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{signOut:signOut,email:email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards,setCards:setCards,isLoggedIn:isLoggedIn}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{register:register})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{enter:enter})})]}),/*#__PURE__*/_jsx(InfoTooltip,{onClose:closeAllPopups,isOpen:isInfoTooltipOpen,overlay:overlayClick,tooltipStatus:tooltipStatus}),/*#__PURE__*/_jsx(AddPlacePopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onAddPlace:handleAddPlaceSubmit,isOpen:isAddPlacePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onUpdateAvatar:handleUpdateAvatar,isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditProfilePopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onUpdateUser:handleUpdateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(ImagePopup,{overlay:overlayClick,isOpen:isImagePopupOpen,onClose:closeAllPopups,card:selectedCard}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","Header","Main","Footer","AddPlacePopup","EditAvatarPopup","EditProfilePopup","api","ImagePopup","CurrentUserContext","Route","Switch","useHistory","Login","Register","ProtectedRoute","InfoTooltip","apiAuth","App","useState","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","cards","setCards","selectedCard","setSelectedCard","isImagePopupOpen","setImagePopupOpen","currentUser","setCurrentUser","isLoading","setIsLoading","isLoggedIn","setIsLoggedIn","email","setEmail","isInfoTooltipOpen","setInfoTooltipOpen","tooltipStatus","setToolTipStatus","history","useEffect","jwt","localStorage","getItem","getContent","then","res","push","catch","err","console","error","getInitialCards","data","reverse","getUserInfo","register","password","log","enter","token","setItem","signOut","removeItem","changeLoading","handleCardClick","closeAllPopups","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleUpdateUser","setUserInfo","finally","handleUpdateAvatar","changeAvatar","handleAddPlaceSubmit","newCard","setCardServer","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCards","map","c","handleCardDelete","deleteCard","filter","window","addEventListener","e","key","overlayClick","classList","contains"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport api from \"../utils/api\";\nimport ImagePopup from \"./ImagePopup\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport {Login} from \"./Login\";\nimport {Register} from \"./Register\";\nimport {ProtectedRoute} from \"./ProtectedRoute\";\nimport {InfoTooltip} from \"./InfoTooltip\";\nimport * as apiAuth from \"../utils/apiAuth\"\n\nfunction App() {\n    const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = React.useState(false);\n    const [isEditProfilePopupOpen, setEditProfilePopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false);\n    const [cards, setCards] = React.useState([])\n    const [selectedCard, setSelectedCard] = React.useState({})\n    const [isImagePopupOpen, setImagePopupOpen] = React.useState(false);\n    const [currentUser, setCurrentUser] = React.useState({})\n    const [isLoading, setIsLoading] = React.useState(false)\n    const [isLoggedIn, setIsLoggedIn] = React.useState(false)\n    const [email, setEmail] = React.useState('')\n    const [isInfoTooltipOpen, setInfoTooltipOpen] = React.useState(false)\n    const [tooltipStatus, setToolTipStatus] = React.useState(false)\n\n    const history = useHistory();\n\n    React.useEffect(() => {\n      const jwt = localStorage.getItem('jwt');\n      if(jwt){\n        apiAuth.getContent(jwt)\n            .then((res) => {\n              setEmail(res.email)\n              setIsLoggedIn(true);\n              history.push('/')\n              setCurrentUser(res)\n\n            })\n            .catch(err => console.error(err))\n        api.getInitialCards()\n            .then(res => {setCards(res.data.reverse())})\n            .catch(err => {console.error(err)})\n      }\n    }, [history, isLoggedIn])\n\n  React.useEffect(() => {\n    api.getUserInfo()\n        .then(res => {\n          setCurrentUser(res)})\n        .catch(err => {console.error(err)})\n  }, [])\n\n  React.useEffect(() => {\n    api.getInitialCards()\n        .then(res => {setCards(res.data.reverse())})\n        .catch(err => {console.error(err)})\n  }, [])\n\n  function register(email, password) {\n    apiAuth.register(email, password)\n        .then((res) => {\n          if (res) {\n            setToolTipStatus(false)\n            setInfoTooltipOpen(true)\n            history.push('/signin');\n          }\n        })\n        .catch((err) => {\n          setToolTipStatus(true)\n          setInfoTooltipOpen(true)\n          console.log(`Упс, произошла ошибка: ${err}`);\n        })\n  }\n\n  function enter(email, password) {\n    apiAuth.enter(email, password)\n        .then((data) => {\n          if (data.token) {\n            setToolTipStatus(false)\n            setInfoTooltipOpen(false)\n            localStorage.setItem('jwt', data.token)\n            setIsLoggedIn(true)\n            history.push('/')\n            setEmail(email)\n\n          } else {\n            setToolTipStatus(true)\n            setInfoTooltipOpen(true)\n          }\n        })\n        .catch((err) => {\n          setToolTipStatus(true)\n          setInfoTooltipOpen(true)\n          console.log(`Упс, произошла ошибка: ${err}`);\n        })\n  }\n\n  function signOut(){\n    localStorage.removeItem('jwt');\n    setIsLoggedIn(false);\n    history.push('/signin');\n  }\n\n\n    const changeLoading = () =>{\n      setIsLoading(true)\n  }\n\n    const handleCardClick = (data) => {\n      setImagePopupOpen(true)\n      setSelectedCard(data)\n    }\n\n    const closeAllPopups = () => {\n        setEditAvatarPopupOpen(false)\n        setEditProfilePopupOpen(false)\n        setAddPlacePopupOpen(false)\n        setImagePopupOpen(false)\n        setInfoTooltipOpen(false)\n    }\n\n    const handleEditProfileClick = () => {\n        setEditProfilePopupOpen(true)\n    }\n    const handleAddPlaceClick = () => {\n        setAddPlacePopupOpen(true)\n    }\n    function handleEditAvatarClick(){\n        setEditAvatarPopupOpen(true)\n    }\n    //Меняет информацию о пользователе\n    const handleUpdateUser = (data) => {\n      api.setUserInfo(data)\n          .then((res) => {\n            setCurrentUser(res.data)\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n    //Меняет аватар\n    const handleUpdateAvatar = (data) => {\n      api.changeAvatar(data)\n          .then((res) => {\n            setCurrentUser(res.data)\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n    //Добавление новой карточки\n    const handleAddPlaceSubmit = (newCard) => {\n      api.setCardServer(newCard)\n          .then((res) => {\n            setCards([res.data, ...cards]);\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeCardStatus(card._id, !isLiked)\n        .then((newCard) => {\n          const newCards = cards.map((c) => c._id === card._id ? newCard.data : c);// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n          //проверяет если id предыдущей карточки равен id полученной при PUT-запросе, то создавай новую карточку из запроса иначе оставляй старую\n          setCards(newCards)\n        })\n        .catch(err => {console.error(err)})\n  }\n\n  function handleCardDelete(card){\n    api.deleteCard(card._id)\n        .then(() => {\n          setCards(cards.filter((c) => c._id !== card._id))\n        })\n        .catch(err => {console.error(err)})\n  }\n\n  React.useEffect(() => {\n    window.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        closeAllPopups();\n      }\n    })\n  },[])\n\n  function overlayClick(e) {\n      if (e.classList.contains('popup')){\n        closeAllPopups()\n      }\n  }\n\n  return (\n      <CurrentUserContext.Provider value={currentUser}>\n          <div className=\"page\">\n            <Header signOut={signOut} email={email} />\n            <Switch>\n              <ProtectedRoute\n                  exact path=\"/\"\n                  component={Main}\n                  onEditAvatar={handleEditAvatarClick}\n                  onEditProfile={handleEditProfileClick}\n                  onAddPlace={handleAddPlaceClick}\n                  onCardClick={handleCardClick}\n                  onCardLike={handleCardLike}\n                  onCardDelete={handleCardDelete}\n                  cards={cards}\n                  setCards={setCards}\n                  isLoggedIn={isLoggedIn}\n              />\n              <Route path=\"/signup\">\n                <Register register={register}/>\n              </Route>\n              <Route path=\"/signin\">\n                <Login enter={enter} />\n              </Route>\n            </Switch>\n            <InfoTooltip\n                onClose={closeAllPopups}\n                isOpen={isInfoTooltipOpen}\n                overlay={overlayClick}\n                tooltipStatus={tooltipStatus}\n            />\n            <AddPlacePopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onAddPlace={handleAddPlaceSubmit}\n                isOpen={isAddPlacePopupOpen}\n                onClose={closeAllPopups}\n            />\n            <EditAvatarPopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onUpdateAvatar={handleUpdateAvatar}\n                isOpen={isEditAvatarPopupOpen}\n                onClose={closeAllPopups}\n            />\n            <EditProfilePopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onUpdateUser={handleUpdateUser}\n                isOpen={isEditProfilePopupOpen}\n                onClose={closeAllPopups}\n            />\n            <ImagePopup overlay={overlayClick} isOpen={isImagePopupOpen} onClose={closeAllPopups} card={selectedCard} />\n            <Footer />\n          </div>\n      </CurrentUserContext.Provider>\n  );\n\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}