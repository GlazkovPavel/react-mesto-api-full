{"ast":null,"code":"import _toConsumableArray from\"/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import AddPlacePopup from\"./AddPlacePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import EditProfilePopup from\"./EditProfilePopup\";import api from\"../utils/api\";import ImagePopup from\"./ImagePopup\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import{Route,Switch,useHistory}from'react-router-dom';import{Login}from\"./Login\";import{Register}from\"./Register\";import{ProtectedRoute}from\"./ProtectedRoute\";import{InfoTooltip}from\"./InfoTooltip\";import*as apiAuth from\"../utils/apiAuth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setEditAvatarPopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),cards=_React$useState8[0],setCards=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),selectedCard=_React$useState10[0],setSelectedCard=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isImagePopupOpen=_React$useState12[0],setImagePopupOpen=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isLoading=_React$useState16[0],setIsLoading=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isLoggedIn=_React$useState18[0],setIsLoggedIn=_React$useState18[1];var _React$useState19=React.useState(''),_React$useState20=_slicedToArray(_React$useState19,2),email=_React$useState20[0],setEmail=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),isInfoTooltipOpen=_React$useState22[0],setInfoTooltipOpen=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),tooltipStatus=_React$useState24[0],setToolTipStatus=_React$useState24[1];var _React$useState25=React.useState(''),_React$useState26=_slicedToArray(_React$useState25,2),jwt=_React$useState26[0],setJwt=_React$useState26[1];var history=useHistory();React.useEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){console.log('apiAuth.getContent',jwt);setJwt(jwt);apiAuth.getContent(jwt).then(function(res){setEmail(res.email);setIsLoggedIn(true);history.push('/');setCurrentUser(res);}).catch(function(err){return console.error(err);});}},[history,isLoggedIn]);React.useEffect(function(){api.getUserInfo(jwt).then(function(data){setCurrentUser(data);}).catch(function(err){console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});api.getInitialCards(jwt)//отправляем запрос на сервер и получаем массив карточек\n.then(function(res){setCards(res.data.reverse());//меняем стейт cards\n}).catch(function(err){console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});},[]);function register(email,password){apiAuth.register(email,password).then(function(res){if(res){setToolTipStatus(false);setInfoTooltipOpen(true);history.push('/signin');}}).catch(function(err){setToolTipStatus(true);setInfoTooltipOpen(true);console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function enter(email,password){apiAuth.enter(email,password).then(function(data){if(data.token){setToolTipStatus(false);setInfoTooltipOpen(false);localStorage.setItem('jwt',data.token);setIsLoggedIn(true);history.push('/');}else{setToolTipStatus(true);setInfoTooltipOpen(true);}}).catch(function(err){setToolTipStatus(true);setInfoTooltipOpen(true);console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function signOut(){localStorage.removeItem('jwt');setIsLoggedIn(false);history.push('/signin');}var changeLoading=function changeLoading(){setIsLoading(true);};var handleCardClick=function handleCardClick(data){setImagePopupOpen(true);setSelectedCard(data);};var closeAllPopups=function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setImagePopupOpen(false);setInfoTooltipOpen(false);};var handleEditProfileClick=function handleEditProfileClick(){setEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setAddPlacePopupOpen(true);};function handleEditAvatarClick(){setEditAvatarPopupOpen(true);}//Меняет информацию о пользователе\nvar handleUpdateUser=function handleUpdateUser(data){api.setUserInfo(data,jwt).then(function(res){setCurrentUser(res.data);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};//Меняет аватар\nvar handleUpdateAvatar=function handleUpdateAvatar(data){api.changeAvatar(data,jwt).then(function(res){setCurrentUser(res.data);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};//Добавление новой карточки\nvar handleAddPlaceSubmit=function handleAddPlaceSubmit(newCard){api.setCardServer(newCard,jwt).then(function(res){setCards([res.data].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked,jwt).then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard.data:c;});// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n//проверяет если id предыдущей карточки равен id полученной при PUT-запросе, то создавай новую карточку из запроса иначе оставляй старую\nsetCards(newCards);}).catch(function(err){console.error(err);});}function handleCardDelete(card){api.deleteCard(card._id,jwt).then(function(){setCards(cards.filter(function(c){return c._id!==card._id;}));}).catch(function(err){console.error(err);});}React.useEffect(function(){window.addEventListener('keydown',function(e){if(e.key==='Escape'){closeAllPopups();}});},[]);function overlayClick(e){if(e.classList.contains('popup')){closeAllPopups();}}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{signOut:signOut,email:email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards,setCards:setCards,isLoggedIn:isLoggedIn}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{register:register})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{enter:enter})})]}),/*#__PURE__*/_jsx(InfoTooltip,{onClose:closeAllPopups,isOpen:isInfoTooltipOpen,overlay:overlayClick,tooltipStatus:tooltipStatus}),/*#__PURE__*/_jsx(AddPlacePopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onAddPlace:handleAddPlaceSubmit,isOpen:isAddPlacePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onUpdateAvatar:handleUpdateAvatar,isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditProfilePopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onUpdateUser:handleUpdateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(ImagePopup,{overlay:overlayClick,isOpen:isImagePopupOpen,onClose:closeAllPopups,card:selectedCard}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","Header","Main","Footer","AddPlacePopup","EditAvatarPopup","EditProfilePopup","api","ImagePopup","CurrentUserContext","Route","Switch","useHistory","Login","Register","ProtectedRoute","InfoTooltip","apiAuth","App","useState","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","cards","setCards","selectedCard","setSelectedCard","isImagePopupOpen","setImagePopupOpen","currentUser","setCurrentUser","isLoading","setIsLoading","isLoggedIn","setIsLoggedIn","email","setEmail","isInfoTooltipOpen","setInfoTooltipOpen","tooltipStatus","setToolTipStatus","jwt","setJwt","history","useEffect","localStorage","getItem","console","log","getContent","then","res","push","catch","err","error","getUserInfo","data","getInitialCards","reverse","register","password","enter","token","setItem","signOut","removeItem","changeLoading","handleCardClick","closeAllPopups","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleUpdateUser","setUserInfo","finally","handleUpdateAvatar","changeAvatar","handleAddPlaceSubmit","newCard","setCardServer","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCards","map","c","handleCardDelete","deleteCard","filter","window","addEventListener","e","key","overlayClick","classList","contains"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport api from \"../utils/api\";\nimport ImagePopup from \"./ImagePopup\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport {Login} from \"./Login\";\nimport {Register} from \"./Register\";\nimport {ProtectedRoute} from \"./ProtectedRoute\";\nimport {InfoTooltip} from \"./InfoTooltip\";\nimport * as apiAuth from \"../utils/apiAuth\"\n\nfunction App() {\n    const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = React.useState(false);\n    const [isEditProfilePopupOpen, setEditProfilePopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false);\n    const [cards, setCards] = React.useState([])\n    const [selectedCard, setSelectedCard] = React.useState({})\n    const [isImagePopupOpen, setImagePopupOpen] = React.useState(false);\n    const [currentUser, setCurrentUser] = React.useState({})\n    const [isLoading, setIsLoading] = React.useState(false)\n    const [isLoggedIn, setIsLoggedIn] = React.useState(false)\n    const [email, setEmail] = React.useState('')\n    const [isInfoTooltipOpen, setInfoTooltipOpen] = React.useState(false)\n    const [tooltipStatus, setToolTipStatus] = React.useState(false)\n    const [jwt, setJwt] = React.useState('')\n\n    const history = useHistory();\n\n\n\n    React.useEffect(() => {\n      const jwt = localStorage.getItem('jwt');\n      if(jwt){\n        console.log('apiAuth.getContent', jwt)\n        setJwt(jwt)\n\n        apiAuth.getContent(jwt)\n            .then((res) => {\n              setEmail(res.email)\n\n              setIsLoggedIn(true);\n              history.push('/')\n              setCurrentUser(res)\n\n            })\n            .catch(err => console.error(err))\n      }\n    }, [history, isLoggedIn])\n\n  React.useEffect(() => {\n    api.getUserInfo(jwt)\n        .then((data) => {\n          setCurrentUser(data);\n        })\n        .catch((err) => {\n          console.log(`Упс, произошла ошибка: ${err}`);\n        });\n    api.getInitialCards(jwt) //отправляем запрос на сервер и получаем массив карточек\n        .then((res) => {\n          setCards(res.data.reverse()); //меняем стейт cards\n        })\n        .catch((err) => {\n          console.log(`Упс, произошла ошибка: ${err}`);\n        });\n  }, []);\n\n  function register(email, password) {\n    apiAuth.register(email, password)\n        .then((res) => {\n          if (res) {\n            setToolTipStatus(false)\n            setInfoTooltipOpen(true)\n            history.push('/signin');\n          }\n        })\n        .catch((err) => {\n          setToolTipStatus(true)\n          setInfoTooltipOpen(true)\n          console.log(`Упс, произошла ошибка: ${err}`);\n        })\n  }\n\n  function enter(email, password) {\n    apiAuth.enter(email, password)\n        .then((data) => {\n          if (data.token) {\n            setToolTipStatus(false)\n            setInfoTooltipOpen(false)\n            localStorage.setItem('jwt', data.token)\n            setIsLoggedIn(true)\n            history.push('/')\n\n          } else {\n            setToolTipStatus(true)\n            setInfoTooltipOpen(true)\n          }\n        })\n        .catch((err) => {\n          setToolTipStatus(true)\n          setInfoTooltipOpen(true)\n          console.log(`Упс, произошла ошибка: ${err}`);\n        })\n  }\n\n  function signOut(){\n    localStorage.removeItem('jwt');\n    setIsLoggedIn(false);\n    history.push('/signin');\n  }\n\n\n    const changeLoading = () =>{\n      setIsLoading(true)\n  }\n\n    const handleCardClick = (data) => {\n      setImagePopupOpen(true)\n      setSelectedCard(data)\n    }\n\n    const closeAllPopups = () => {\n        setEditAvatarPopupOpen(false)\n        setEditProfilePopupOpen(false)\n        setAddPlacePopupOpen(false)\n        setImagePopupOpen(false)\n        setInfoTooltipOpen(false)\n    }\n\n    const handleEditProfileClick = () => {\n        setEditProfilePopupOpen(true)\n    }\n    const handleAddPlaceClick = () => {\n        setAddPlacePopupOpen(true)\n    }\n    function handleEditAvatarClick(){\n        setEditAvatarPopupOpen(true)\n    }\n    //Меняет информацию о пользователе\n    const handleUpdateUser = (data) => {\n      api.setUserInfo(data, jwt)\n          .then((res) => {\n            setCurrentUser(res.data)\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n    //Меняет аватар\n    const handleUpdateAvatar = (data) => {\n      api.changeAvatar(data, jwt)\n          .then((res) => {\n            setCurrentUser(res.data)\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n    //Добавление новой карточки\n    const handleAddPlaceSubmit = (newCard) => {\n      api.setCardServer(newCard, jwt)\n          .then((res) => {\n            setCards([res.data, ...cards]);\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeCardStatus(card._id, !isLiked, jwt)\n        .then((newCard) => {\n          const newCards = cards.map((c) => c._id === card._id ? newCard.data : c);// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n          //проверяет если id предыдущей карточки равен id полученной при PUT-запросе, то создавай новую карточку из запроса иначе оставляй старую\n          setCards(newCards)\n        })\n        .catch(err => {console.error(err)})\n  }\n\n  function handleCardDelete(card){\n    api.deleteCard(card._id, jwt)\n        .then(() => {\n          setCards(cards.filter((c) => c._id !== card._id))\n        })\n        .catch(err => {console.error(err)})\n  }\n\n  React.useEffect(() => {\n    window.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        closeAllPopups();\n      }\n    })\n  },[])\n\n  function overlayClick(e) {\n      if (e.classList.contains('popup')){\n        closeAllPopups()\n      }\n  }\n\n  return (\n      <CurrentUserContext.Provider value={currentUser}>\n          <div className=\"page\">\n            <Header signOut={signOut} email={email} />\n            <Switch>\n              <ProtectedRoute\n                  exact path=\"/\"\n                  component={Main}\n                  onEditAvatar={handleEditAvatarClick}\n                  onEditProfile={handleEditProfileClick}\n                  onAddPlace={handleAddPlaceClick}\n                  onCardClick={handleCardClick}\n                  onCardLike={handleCardLike}\n                  onCardDelete={handleCardDelete}\n                  cards={cards}\n                  setCards={setCards}\n                  isLoggedIn={isLoggedIn}\n              />\n              <Route path=\"/signup\">\n                <Register register={register}/>\n              </Route>\n              <Route path=\"/signin\">\n                <Login enter={enter} />\n              </Route>\n            </Switch>\n            <InfoTooltip\n                onClose={closeAllPopups}\n                isOpen={isInfoTooltipOpen}\n                overlay={overlayClick}\n                tooltipStatus={tooltipStatus}\n            />\n            <AddPlacePopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onAddPlace={handleAddPlaceSubmit}\n                isOpen={isAddPlacePopupOpen}\n                onClose={closeAllPopups}\n            />\n            <EditAvatarPopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onUpdateAvatar={handleUpdateAvatar}\n                isOpen={isEditAvatarPopupOpen}\n                onClose={closeAllPopups}\n            />\n            <EditProfilePopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onUpdateUser={handleUpdateUser}\n                isOpen={isEditProfilePopupOpen}\n                onClose={closeAllPopups}\n            />\n            <ImagePopup overlay={overlayClick} isOpen={isImagePopupOpen} onClose={closeAllPopups} card={selectedCard} />\n            <Footer />\n          </div>\n      </CurrentUserContext.Provider>\n  );\n\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}