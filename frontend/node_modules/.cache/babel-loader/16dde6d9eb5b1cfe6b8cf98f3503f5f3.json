{"ast":null,"code":"import _toConsumableArray from\"/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import AddPlacePopup from\"./AddPlacePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import EditProfilePopup from\"./EditProfilePopup\";import api from\"../utils/api\";import ImagePopup from\"./ImagePopup\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import{Route,Switch,useHistory}from'react-router-dom';import{Login}from\"./Login\";import{Register}from\"./Register\";import{ProtectedRoute}from\"./ProtectedRoute\";import{InfoTooltip}from\"./InfoTooltip\";import*as apiAuth from\"../utils/apiAuth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setEditAvatarPopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),cards=_React$useState8[0],setCards=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),selectedCard=_React$useState10[0],setSelectedCard=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isImagePopupOpen=_React$useState12[0],setImagePopupOpen=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isLoading=_React$useState16[0],setIsLoading=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isLoggedIn=_React$useState18[0],setIsLoggedIn=_React$useState18[1];var _React$useState19=React.useState(''),_React$useState20=_slicedToArray(_React$useState19,2),email=_React$useState20[0],setEmail=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),isInfoTooltipOpen=_React$useState22[0],setInfoTooltipOpen=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),tooltipStatus=_React$useState24[0],setToolTipStatus=_React$useState24[1];var history=useHistory();// React.useEffect(() => {\n//   const jwt = localStorage.getItem('jwt');\n//   if(jwt){\n//     apiAuth.getContent(jwt)\n//         .then((res) => {\n//           setEmail(res.email)\n//           setIsLoggedIn(true);\n//           history.push('/')\n//           setCurrentUser(res)\n//\n//         })\n//         .catch(err => console.error(err))\n//     // api.getInitialCards()\n//     //     .then(res => {setCards(res.data.reverse())})\n//     //     .catch(err => {console.error(err)})\n//   }\n// }, [history, isLoggedIn])\nReact.useEffect(function(){api.getUserInfo().then(function(data){setEmail(data.email);setCurrentUser(data);}).catch(function(err){console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});api.getInitialCards('/cards')//отправляем запрос на сервер и получаем массив карточек\n.then(function(res){setCards(res.data.reverse());//меняем стейт cards\n}).catch(function(err){console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});},[]);function register(email,password){apiAuth.register(email,password).then(function(res){if(res){setToolTipStatus(false);setInfoTooltipOpen(true);history.push('/signin');}}).catch(function(err){setToolTipStatus(true);setInfoTooltipOpen(true);console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function enter(email,password){apiAuth.enter(email,password).then(function(data){if(data.token){setToolTipStatus(false);setInfoTooltipOpen(false);localStorage.setItem('jwt',data.token);setIsLoggedIn(true);history.push('/');}else{setToolTipStatus(true);setInfoTooltipOpen(true);}}).catch(function(err){setToolTipStatus(true);setInfoTooltipOpen(true);console.log(\"\\u0423\\u043F\\u0441, \\u043F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));});}function signOut(){localStorage.removeItem('jwt');setIsLoggedIn(false);history.push('/signin');}var changeLoading=function changeLoading(){setIsLoading(true);};var handleCardClick=function handleCardClick(data){setImagePopupOpen(true);setSelectedCard(data);};var closeAllPopups=function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setImagePopupOpen(false);setInfoTooltipOpen(false);};var handleEditProfileClick=function handleEditProfileClick(){setEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setAddPlacePopupOpen(true);};function handleEditAvatarClick(){setEditAvatarPopupOpen(true);}//Меняет информацию о пользователе\nvar handleUpdateUser=function handleUpdateUser(data){api.setUserInfo(data).then(function(res){setCurrentUser(res.data);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};//Меняет аватар\nvar handleUpdateAvatar=function handleUpdateAvatar(data){api.changeAvatar(data).then(function(res){setCurrentUser(res.data);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};//Добавление новой карточки\nvar handleAddPlaceSubmit=function handleAddPlaceSubmit(newCard){api.setCardServer(newCard).then(function(res){setCards([res.data].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard.data:c;});// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n//проверяет если id предыдущей карточки равен id полученной при PUT-запросе, то создавай новую карточку из запроса иначе оставляй старую\nsetCards(newCards);}).catch(function(err){console.error(err);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(){setCards(cards.filter(function(c){return c._id!==card._id;}));}).catch(function(err){console.error(err);});}React.useEffect(function(){window.addEventListener('keydown',function(e){if(e.key==='Escape'){closeAllPopups();}});},[]);function overlayClick(e){if(e.classList.contains('popup')){closeAllPopups();}}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{signOut:signOut,email:email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards,setCards:setCards,isLoggedIn:isLoggedIn}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{register:register})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{enter:enter})})]}),/*#__PURE__*/_jsx(InfoTooltip,{onClose:closeAllPopups,isOpen:isInfoTooltipOpen,overlay:overlayClick,tooltipStatus:tooltipStatus}),/*#__PURE__*/_jsx(AddPlacePopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onAddPlace:handleAddPlaceSubmit,isOpen:isAddPlacePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onUpdateAvatar:handleUpdateAvatar,isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditProfilePopup,{isLoading:isLoading,onChangeLoading:changeLoading,overlay:overlayClick,onUpdateUser:handleUpdateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(ImagePopup,{overlay:overlayClick,isOpen:isImagePopupOpen,onClose:closeAllPopups,card:selectedCard}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["/Users/pavelglazkov/Desktop/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","Header","Main","Footer","AddPlacePopup","EditAvatarPopup","EditProfilePopup","api","ImagePopup","CurrentUserContext","Route","Switch","useHistory","Login","Register","ProtectedRoute","InfoTooltip","apiAuth","App","useState","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","cards","setCards","selectedCard","setSelectedCard","isImagePopupOpen","setImagePopupOpen","currentUser","setCurrentUser","isLoading","setIsLoading","isLoggedIn","setIsLoggedIn","email","setEmail","isInfoTooltipOpen","setInfoTooltipOpen","tooltipStatus","setToolTipStatus","history","useEffect","getUserInfo","then","data","catch","err","console","log","getInitialCards","res","reverse","register","password","push","enter","token","localStorage","setItem","signOut","removeItem","changeLoading","handleCardClick","closeAllPopups","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleUpdateUser","setUserInfo","error","finally","handleUpdateAvatar","changeAvatar","handleAddPlaceSubmit","newCard","setCardServer","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCards","map","c","handleCardDelete","deleteCard","filter","window","addEventListener","e","key","overlayClick","classList","contains"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport api from \"../utils/api\";\nimport ImagePopup from \"./ImagePopup\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport {Login} from \"./Login\";\nimport {Register} from \"./Register\";\nimport {ProtectedRoute} from \"./ProtectedRoute\";\nimport {InfoTooltip} from \"./InfoTooltip\";\nimport * as apiAuth from \"../utils/apiAuth\"\n\nfunction App() {\n    const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = React.useState(false);\n    const [isEditProfilePopupOpen, setEditProfilePopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false);\n    const [cards, setCards] = React.useState([])\n    const [selectedCard, setSelectedCard] = React.useState({})\n    const [isImagePopupOpen, setImagePopupOpen] = React.useState(false);\n    const [currentUser, setCurrentUser] = React.useState({})\n    const [isLoading, setIsLoading] = React.useState(false)\n    const [isLoggedIn, setIsLoggedIn] = React.useState(false)\n    const [email, setEmail] = React.useState('')\n    const [isInfoTooltipOpen, setInfoTooltipOpen] = React.useState(false)\n    const [tooltipStatus, setToolTipStatus] = React.useState(false)\n\n    const history = useHistory();\n\n    // React.useEffect(() => {\n    //   const jwt = localStorage.getItem('jwt');\n    //   if(jwt){\n    //     apiAuth.getContent(jwt)\n    //         .then((res) => {\n    //           setEmail(res.email)\n    //           setIsLoggedIn(true);\n    //           history.push('/')\n    //           setCurrentUser(res)\n    //\n    //         })\n    //         .catch(err => console.error(err))\n    //     // api.getInitialCards()\n    //     //     .then(res => {setCards(res.data.reverse())})\n    //     //     .catch(err => {console.error(err)})\n    //   }\n    // }, [history, isLoggedIn])\n\n  React.useEffect(() => {\n    api.getUserInfo()\n        .then((data) => {\n          setEmail(data.email)\n          setCurrentUser(data);\n        })\n        .catch((err) => {\n          console.log(`Упс, произошла ошибка: ${err}`);\n        });\n    api.getInitialCards('/cards') //отправляем запрос на сервер и получаем массив карточек\n        .then((res) => {\n          setCards(res.data.reverse()); //меняем стейт cards\n        })\n        .catch((err) => {\n          console.log(`Упс, произошла ошибка: ${err}`);\n        });\n  }, []);\n\n  function register(email, password) {\n    apiAuth.register(email, password)\n        .then((res) => {\n          if (res) {\n            setToolTipStatus(false)\n            setInfoTooltipOpen(true)\n            history.push('/signin');\n          }\n        })\n        .catch((err) => {\n          setToolTipStatus(true)\n          setInfoTooltipOpen(true)\n          console.log(`Упс, произошла ошибка: ${err}`);\n        })\n  }\n\n  function enter(email, password) {\n    apiAuth.enter(email, password)\n        .then((data) => {\n          if (data.token) {\n            setToolTipStatus(false)\n            setInfoTooltipOpen(false)\n            localStorage.setItem('jwt', data.token)\n            setIsLoggedIn(true)\n            history.push('/')\n\n          } else {\n            setToolTipStatus(true)\n            setInfoTooltipOpen(true)\n          }\n        })\n        .catch((err) => {\n          setToolTipStatus(true)\n          setInfoTooltipOpen(true)\n          console.log(`Упс, произошла ошибка: ${err}`);\n        })\n  }\n\n  function signOut(){\n    localStorage.removeItem('jwt');\n    setIsLoggedIn(false);\n    history.push('/signin');\n  }\n\n\n    const changeLoading = () =>{\n      setIsLoading(true)\n  }\n\n    const handleCardClick = (data) => {\n      setImagePopupOpen(true)\n      setSelectedCard(data)\n    }\n\n    const closeAllPopups = () => {\n        setEditAvatarPopupOpen(false)\n        setEditProfilePopupOpen(false)\n        setAddPlacePopupOpen(false)\n        setImagePopupOpen(false)\n        setInfoTooltipOpen(false)\n    }\n\n    const handleEditProfileClick = () => {\n        setEditProfilePopupOpen(true)\n    }\n    const handleAddPlaceClick = () => {\n        setAddPlacePopupOpen(true)\n    }\n    function handleEditAvatarClick(){\n        setEditAvatarPopupOpen(true)\n    }\n    //Меняет информацию о пользователе\n    const handleUpdateUser = (data) => {\n      api.setUserInfo(data)\n          .then((res) => {\n            setCurrentUser(res.data)\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n    //Меняет аватар\n    const handleUpdateAvatar = (data) => {\n      api.changeAvatar(data)\n          .then((res) => {\n            setCurrentUser(res.data)\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n    //Добавление новой карточки\n    const handleAddPlaceSubmit = (newCard) => {\n      api.setCardServer(newCard)\n          .then((res) => {\n            setCards([res.data, ...cards]);\n            closeAllPopups()\n          })\n          .catch(err => {console.error(err)})\n          .finally(() => {\n            setIsLoading(false)\n          })\n    }\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeCardStatus(card._id, !isLiked)\n        .then((newCard) => {\n          const newCards = cards.map((c) => c._id === card._id ? newCard.data : c);// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n          //проверяет если id предыдущей карточки равен id полученной при PUT-запросе, то создавай новую карточку из запроса иначе оставляй старую\n          setCards(newCards)\n        })\n        .catch(err => {console.error(err)})\n  }\n\n  function handleCardDelete(card){\n    api.deleteCard(card._id)\n        .then(() => {\n          setCards(cards.filter((c) => c._id !== card._id))\n        })\n        .catch(err => {console.error(err)})\n  }\n\n  React.useEffect(() => {\n    window.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        closeAllPopups();\n      }\n    })\n  },[])\n\n  function overlayClick(e) {\n      if (e.classList.contains('popup')){\n        closeAllPopups()\n      }\n  }\n\n  return (\n      <CurrentUserContext.Provider value={currentUser}>\n          <div className=\"page\">\n            <Header signOut={signOut} email={email} />\n            <Switch>\n              <ProtectedRoute\n                  exact path=\"/\"\n                  component={Main}\n                  onEditAvatar={handleEditAvatarClick}\n                  onEditProfile={handleEditProfileClick}\n                  onAddPlace={handleAddPlaceClick}\n                  onCardClick={handleCardClick}\n                  onCardLike={handleCardLike}\n                  onCardDelete={handleCardDelete}\n                  cards={cards}\n                  setCards={setCards}\n                  isLoggedIn={isLoggedIn}\n              />\n              <Route path=\"/signup\">\n                <Register register={register}/>\n              </Route>\n              <Route path=\"/signin\">\n                <Login enter={enter} />\n              </Route>\n            </Switch>\n            <InfoTooltip\n                onClose={closeAllPopups}\n                isOpen={isInfoTooltipOpen}\n                overlay={overlayClick}\n                tooltipStatus={tooltipStatus}\n            />\n            <AddPlacePopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onAddPlace={handleAddPlaceSubmit}\n                isOpen={isAddPlacePopupOpen}\n                onClose={closeAllPopups}\n            />\n            <EditAvatarPopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onUpdateAvatar={handleUpdateAvatar}\n                isOpen={isEditAvatarPopupOpen}\n                onClose={closeAllPopups}\n            />\n            <EditProfilePopup\n                isLoading={isLoading}\n                onChangeLoading={changeLoading}\n                overlay={overlayClick}\n                onUpdateUser={handleUpdateUser}\n                isOpen={isEditProfilePopupOpen}\n                onClose={closeAllPopups}\n            />\n            <ImagePopup overlay={overlayClick} isOpen={isImagePopupOpen} onClose={closeAllPopups} card={selectedCard} />\n            <Footer />\n          </div>\n      </CurrentUserContext.Provider>\n  );\n\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}